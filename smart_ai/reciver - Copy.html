<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Receiver</title>
</head>
<body>
  <h2>Waiting for file from your assistant...</h2>
  <div id="status">Connecting to server...</div>

  <script>
    const status = document.getElementById("status");

    // Connect to WebSocket signaling server
    const socket = new WebSocket("wss://your-server-url"); // Replace with actual server URL

    socket.onopen = () => {
      status.textContent = "Connected. Waiting for file...";
      Notification.requestPermission();
    };

    let fileMeta = null;
    let chunks = [];

    socket.onmessage = async (event) => {
      if (typeof event.data === "string") {
        fileMeta = JSON.parse(event.data);
        status.textContent = `Receiving: ${fileMeta.name} (${Math.round(fileMeta.size / 1024)} KB)`;
      } else {
        chunks.push(event.data);
        const blob = new Blob(chunks);

        // Download the file automatically
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = fileMeta.name;
        document.body.appendChild(a);
        a.click();
        a.remove();

        // Show mobile notification
        if (Notification.permission === "granted") {
          navigator.serviceWorker.register("sw.js").then(reg => {
            reg.showNotification("üìÅ File Received", {
              body: `${fileMeta.name} has been transferred to your device.`,
              icon: "https://cdn-icons-png.flaticon.com/512/109/109612.png",
              vibrate: [200, 100, 200]
            });
          });
        }

        status.textContent = `‚úÖ File '${fileMeta.name}' received.`;
      }
    };

    socket.onerror = () => {
      status.textContent = "‚ùå Could not connect to the file server.";
    };
  </script>
</body>
</html>
